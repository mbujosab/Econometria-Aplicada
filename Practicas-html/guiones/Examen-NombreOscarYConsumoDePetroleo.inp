# ------------------------------------------------------------
# Copyright (C) 2025 Marcos Bujosa
# Licencia: GNU General Public License v3.0 o posterior
# Este código es software libre y puede ser redistribuido y/o modificado bajo los términos de la GPL.
# Ver el archivo LICENSE del repositorio para más detalles.
# ------------------------------------------------------------

# Los dos primeros comandos son necesarios para que Gretl guarde los resultados de la práctica en el directorio de trabajo
# al ejecutar lo siguiente desde un terminal (use los nombres y ruta que correspondan)
#
#    DIRECTORIO="Nombre_Directorio_trabajo" gretlcli -b ruta/nombre_fichero_de_la_practica.inp
#
# Si esto no le funciona en su sistema, comente las siguientes dos líneas y sitúese en el directorio de trabajo de gretl
# que corresponda (configure dicho directorio de trabajo desde la ventana principal de Gretl).

string directory = getenv("DIRECTORIO")
set workdir "@directory"

open ../../datos/NombreOscarYConsumoDePetroleo.gdt

gnuplot ConsumoPetroleo FrecuenciaOscar  --time-series --with-lines --output="PetroleoOscar.png"

gnuplot ConsumoPetroleo --time-series --with-lines --output="consumoPetroleo.png"
corrgm ConsumoPetroleo 9 --plot="consumoPetroleoACF-PACF.png"

outfile --quiet modeloPetroleo1.txt
    arima 1 0 1 ; ConsumoPetroleo
end outfile

series res1petroleo = $uhat
outfile --quiet Residuos1PetroleoACF-PACF.txt
    corrgm res1petroleo --quiet
end outfile

outfile --quiet modeloPetroleo2.txt
    arima 1 1 0 --nc ; ConsumoPetroleo
end outfile

series res2petroleo = $uhat
outfile --quiet Residuos2PetroleoACF-PACF.txt
  corrgm res2petroleo --quiet
end outfile

gnuplot FrecuenciaOscar --time-series --with-lines --output="consumoOscar.png"
corrgm FrecuenciaOscar --plot="consumoOscarACF-PACF.png"

outfile --quiet modeloOscar1.txt
    arima 1 0 1 ; FrecuenciaOscar
end outfile

series res1Oscar = $uhat
outfile --quiet Residuos1OscarACF-PACF.txt
    corrgm res1Oscar --quiet
end outfile

outfile --quiet modeloOscar2.txt
    arima 1 1 0 --nc ; FrecuenciaOscar
end outfile

series res2Oscar = $uhat
outfile --quiet Residuos2OscarACF-PACF.txt
    corrgm res2Oscar --quiet
end outfile

outfile --quiet test_cointegracion.txt
    coint 2 ConsumoPetroleo FrecuenciaOscar --test-down
end outfile

outfile --quiet modeloMCO.txt
    ols ConsumoPetroleo 0 FrecuenciaOscar
    modtest --normality --quiet
    modtest --white --quiet
    modtest --autocorr 1 --quiet
end outfile

outfile --quiet modeloMCO_AR1.txt
    ar1 ConsumoPetroleo 0 FrecuenciaOscar
    modtest --normality --quiet
end outfile

outfile --quiet modeloMCO_en_diff.txt
    diff ConsumoPetroleo FrecuenciaOscar
    ols d_ConsumoPetroleo 0 d_FrecuenciaOscar
    modtest --normality --quiet
    modtest --white --quiet
    modtest --autocorr 2 --quiet
end outfile

outfile --quiet modeloMCO_en_diff_intervencionC.txt
    diff ConsumoPetroleo FrecuenciaOscar Covid
    ols d_ConsumoPetroleo 0 d_FrecuenciaOscar d_Covid
    modtest --normality --quiet
    modtest --white --quiet
    modtest --autocorr 2 --quiet
end outfile
